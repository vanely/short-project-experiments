# Use the official PostgreSQL image as base
FROM postgres:15-alpine

# Set environment variables for PostgreSQL
ENV POSTGRES_DB=todo_db
ENV POSTGRES_USER=todo_user
ENV POSTGRES_PASSWORD=todo_password

# Create a directory for initialization scripts
RUN mkdir -p /docker-entrypoint-initdb.d

# Create the database and user scripts
RUN echo "CREATE DATABASE todo_db;" > /docker-entrypoint-initdb.d/01-create-database.sql
RUN echo "CREATE USER todo_user WITH PASSWORD 'todo_password';" > /docker-entrypoint-initdb.d/02-create-user.sql
RUN echo "GRANT ALL PRIVILEGES ON DATABASE todo_db TO todo_user;" > /docker-entrypoint-initdb.d/03-grant-privileges.sql

# Copy initialization script (will be mounted at runtime)
COPY ./docker/postgres/init.sql /docker-entrypoint-initdb.d/04-init.sql

# Expose PostgreSQL port
EXPOSE 5432

# Set default command
CMD ["postgres"] 